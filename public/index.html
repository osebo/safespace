<html>
  <head>
    <meta charset="utf-8">
    <title>Safe space</title>
    <meta name="description" content="Tumblr WebVR Community">

    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <script src="easyrtc/easyrtc.js"></script>
    <script src="https://unpkg.com/networked-aframe@^0.2.0/dist/networked-aframe.min.js"></script>

    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.5/dist/aframe-particle-system-component.min.js"></script>
    <script src="/js/spawn-in-circle.component.js"></script>
    <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
    <script>
      // Define custom schema for syncing avatar color, set by random-color
      var avatarSchema = {
        template: '#avatar-template',
        components: [
          'position',
          'rotation',
          {
            selector: '.head',
            component: 'material'
          }
        ]
      };
      NAF.schemas.add(avatarSchema);
      
      var pickImg = function (data, num) {
        const randomNum = Math.floor(Math.random()*data.length);
        const img = data[randomNum];
        data.splice(randomNum, 1);
        $('#posts'+num).attr('src', img.url);
        console.log(img);
        return data;
      };
      const tag3D = $.getJSON('tags.json', function(data){
        console.log('\n\n*******json******\n\n');
        console.log(data);
        for(i=1; i<= 16; i++){
          data = pickImg(data, i);
        }
      });

    </script>
    
  </head>
  <body style="background-color: #000; color: #fff; font-family: courier new">
    
    <div class="banner" style="left: 15px;font-size: .8rem; z-index: 99999; position: absolute;display: flex; align: center; margin: auto;">
      <p>  
        <span style="letter-spacing: 4px;font-weight: bold;font-family: courier new">safe space</span> is a 3D experience for viewing the future of Tumblr with friends. Share the link to view with others and refresh for more photos.

      </p>
    </div>
    
    <a-scene vr-mode-ui="enabled: false" networked-scene="
      room: basic;
      webrtc: true;
      webrtcAudio: true;
      debug: true;">
      <a-assets>
        
        <a-asset-item id="avatar-obj" src="https://rawgit.com/osebo/tumblr-models/master/avatar%201.Obj"></a-asset-item>
        <a-asset-item id="avatar-mtl" src="https://rawgit.com/osebo/tumblr-models/master/avatar%201.mtl"></a-asset-item>
        
        <img id="posts1">
        <img id="posts2">
        <img id="posts3">
        <img id="posts4">
        <img id="posts5">
        <img id="posts6">
        <img id="posts7">
        <img id="posts8">
        <img id="posts9">
        <img id="posts10">
        <img id="posts11">
        <img id="posts12">
        <img id="posts13">
        <img id="posts14">
        <img id="posts15">
        <img id="posts16">
        
        <img id="grid" src="https://img.gs/bbdkhfbzkk/stretch/https://i.imgur.com/25P1geh.png" crossorigin="anonymous">
        <img id="sky" src="https://img.gs/bbdkhfbzkk/2048x2048,stretch/http://i.imgur.com/WqlqEkq.jpg" crossorigin="anonymous" />

        <!-- Templates -->

        <!-- Avatar -->
        <script id="avatar-template" type="text/html">
          <a-entity class="avatar">
            <a-sphere class="head"
              color="#5985ff"
              scale="0.45 0.5 0.4"
              random-color
            ></a-sphere>
            <a-entity class="face"
              position="0 0.05 0"
            >
              <a-sphere class="eye"
                color="#efefef"
                position="0.16 0.1 -0.35"
                scale="0.12 0.12 0.12"
              >
                <a-sphere class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
              <a-sphere class="eye"
                color="#efefef"
                position="-0.16 0.1 -0.35"
                scale="0.12 0.12 0.12"
              >
                <a-sphere class="pupil"
                  color="#000"
                  position="0 0 -1"
                  scale="0.2 0.2 0.2"
                ></a-sphere>
              </a-sphere>
            </a-entity>
          </a-entity>
        </script>

        <!-- /Templates -->
      </a-assets>
      
      <a-entity obj-model="obj: #avatar-obj; mtl: #avatar-mtl" position="0 1 3" rotation="0 -120 0" scale="3 3 3"></a-entity>
      
      
      <a-box src="#posts1" material="#posts1" height="3" width="3" depth="3" position="0 2 7" rotation="0 0 0"></a-box>
      <a-box src="#posts2" material="#posts1" height="3" width="3" depth="3" position="10 2 7" rotation="0 0 0"></a-box>
      <a-box src="#posts3" material="#posts1" height="3" width="3" depth="3" position="20 2 7" rotation="0 0 0"></a-box>
      <a-box src="#posts4" material="#posts1" height="3" width="3" depth="3" position="30 2 7" rotation="0 0 0"></a-box>
      <a-box src="#posts5" material="#posts1" height="3" width="3" depth="3" position="0 2 17" rotation="0 0 0"></a-box>
      <a-box src="#posts6" material="#posts1" height="3" width="3" depth="3" position="10 2 17" rotation="0 0 0"></a-box>   
      <a-box src="#posts7" material="#posts1" height="3" width="3" depth="3" position="20 2 17" rotation="0 0 0"></a-box>   
      <a-box src="#posts8" material="#posts1" height="3" width="3" depth="3" position="30 2 17" rotation="0 0 0"></a-box>   
      <a-box src="#posts9" material="#posts1" height="3" width="3" depth="3" position="0 2 27" rotation="0 0 0"></a-box>  <a-box src="#posts3" material="#posts1" height="3" width="3" depth="3" position="20 2 7" rotation="0 0 0"></a-box>
      <a-box src="#posts10" material="#posts1" height="3" width="3" depth="3" position="10 2 27" rotation="0 0 0"></a-box>
      <a-box src="#posts11" material="#posts1" height="3" width="3" depth="3" position="20 2 27" rotation="0 0 0"></a-box>
      <a-box src="#posts12" material="#posts1" height="3" width="3" depth="3" position="30 2 27" rotation="0 0 0"></a-box>   
      <a-box src="#posts13" material="#posts1" height="3" width="3" depth="3" position="0 2 37" rotation="0 0 0"></a-box>   
      <a-box src="#posts14" material="#posts1" height="3" width="3" depth="3" position="10 2 37" rotation="0 0 0"></a-box>   
      <a-box src="#posts15" material="#posts1" height="3" width="3" depth="3" position="20 2 37" rotation="0 0 0"></a-box>  
      <a-box src="#posts16" material="#posts1" height="3" width="3" depth="3" position="30 2 37" rotation="0 0 0"></a-box>  




      <a-entity id="player" networked="template:#avatar-template;showLocalTemplate:false;" camera spawn-in-circle="radius:3;" position="0 1.3 0" wasd-controls look-controls>
      </a-entity>
  
      <a-entity position="0 0 0"
        geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0"
        material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;"></a-entity>

      <a-entity light="color: #ccccff; intensity: 1; type: ambient;" visible=""></a-entity>
      <a-entity light="color: #ffaaff; intensity: 1.5" position="5 5 5"></a-entity>

      <a-sky color="#000000" rotation="0 -90 0"></a-sky>
      <a-entity id="particles" particle-system="preset: snow"></a-entity>
    </a-scene>

    <script>
      // On mobile remove elements that are resource heavy
      var isMobile = AFRAME.utils.device.isMobile();

      if (isMobile) {
        var particles = document.getElementById('particles');
        particles.parentNode.removeChild(particles);
      }
    </script>
  </body>
</html>